{
  "#type": "chain",
  "chain": [
    {
      "#type": "http_request",
      "url": "{[R]%.elasticsearch.url}/_search",
      "method": "POST",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Basic {%.elasticsearch.auth_token}"
      },
      "body": "$",
      "require_response": true,
      "require_allowed": true
    },
    {
      "results": {
        "#type": "as_list",
        "values": {
          "#type": "for_each",
          "values": "$.hits.hits",
          "spec": {
            "#type": "merge",
            "values": [
              "$._source",
              {
                "highlight": "$.highlight"
              }
            ]
          }
        }
      },
      "aggregations": "$.aggregations",
      "stats": {
        "total": "$.hits.total.value"
      }
    }
  ]
}